<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bride Buddy - Choose Your Plan</title>
    <link rel="stylesheet" href="/css/styles-v2.css">
</head>
<body class="bg-gradient">
    <div class="screen">
        <div class="container">
            <h1 class="logo text-center mb-md">Bride Buddy</h1>
            <h2 class="text-white text-center mb-lg">Choose Your Plan</h2>
            <p class="text-white text-center mb-lg" style="opacity: 0.9;">Start your 7-day free trial. No credit card required!</p>
            
            <div class="pricing-container">
                <!-- VIP Plan -->
                <div class="pricing-card fade-in">
                    <h3 class="pricing-title">VIP</h3>
                    
                    <div class="pricing-price">
                        $12.99<span class="pricing-price-period">/month</span>
                    </div>
                    <div class="pricing-divider">or</div>
                    <div class="pricing-price">
                        $99<span class="pricing-price-period"> one-time</span>
                    </div>
                    
                    <ul class="pricing-features">
                        <li>Full wedding planning tools</li>
                        <li>Unlimited AI chat assistant</li>
                        <li>Unlimited partners & co-planners</li>
                        <li>Budget tracking</li>
                        <li>Guest management</li>
                        <li>Vendor coordination</li>
                        <li>Task management</li>
                    </ul>
                    
                    <button class="btn btn-primary btn-full" onclick="selectPlan('vip', 'monthly')">
                        Start Free Trial
                    </button>
                    <button class="btn btn-ghost btn-full mt-sm" onclick="selectPlan('vip', 'one_time')">
                        One-Time Payment
                    </button>
                </div>

                <!-- VIP + Bestie Plan -->
                <div class="pricing-card recommended fade-in" style="animation-delay: 0.1s;">
                    <span class="pricing-badge">Recommended</span>
                    
                    <h3 class="pricing-title">VIP + Bestie</h3>
                    
                    <div class="pricing-price">
                        $19.99<span class="pricing-price-period">/month</span>
                    </div>
                    <div class="pricing-divider">or</div>
                    <div class="pricing-price">
                        $149<span class="pricing-price-period"> one-time</span>
                    </div>
                    
                    <ul class="pricing-features">
                        <li>Everything in VIP</li>
                        <li>Separate Bestie interface</li>
                        <li>Bachelorette party planning</li>
                        <li>Bridal shower planning</li>
                        <li>Bridesmaid tracker</li>
                        <li>Payment tracking</li>
                        <li>Bestie AI chat assistant</li>
                    </ul>
                    
                    <button class="btn btn-primary btn-full" onclick="selectPlan('vip_bestie', 'monthly')">
                        Start Free Trial
                    </button>
                    <button class="btn btn-ghost btn-full mt-sm" onclick="selectPlan('vip_bestie', 'one_time')">
                        One-Time Payment
                    </button>
                </div>
            </div>
            
            <p class="text-white text-center mt-lg" style="opacity: 0.7; font-size: 0.875rem;">
                7-day free trial included. Cancel anytime. No surprises.
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabase = window.supabase.createClient(
            'https://nluvnjydydotsrpluhey.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sdXZuanlkeWRvdHNycGx1aGV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NjE5MjAsImV4cCI6MjA3NjMzNzkyMH0.p5S8vYtZeYqp24avigifhjEDRaKv8TxJTaTkeLoE5mY'
        );

        // Get wedding_id from URL
        const urlParams = new URLSearchParams(window.location.search);
        const weddingId = urlParams.get('wedding_id');

        if (!weddingId) {
            alert('No wedding ID found. Please complete onboarding first.');
            window.location.href = 'welcome-v2.html';
        }

        // Map tier + billing to Stripe Price IDs
        const PRICE_IDS = {
            'vip_monthly': 'price_1SHYkGDn8y3nIH6VnJNyAsE1',     // $12.99/month
            'vip_one_time': 'price_1SHYjrDn8y3nIH6VtE3aORiS',    // $99 one-time
            'vip_bestie_monthly': 'price_YOUR_BESTIE_MONTHLY',   // $19.99/month - ADD YOUR PRICE ID
            'vip_bestie_one_time': 'price_YOUR_BESTIE_ONETIME'   // $149 one-time - ADD YOUR PRICE ID
        };

        async function selectPlan(tier, billing) {
            try {
                // If "monthly" (Start Free Trial), skip to dashboard - trial already started
                if (billing === 'monthly') {
                    window.location.href = `dashboard-v2.html?wedding_id=${weddingId}`;
                    return;
                }

                // For one-time payment, go through Stripe checkout
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    alert('Please log in to continue.');
                    window.location.href = 'login-v2.html';
                    return;
                }

                // Get the price ID for this tier + billing combo
                const priceKey = `${tier}_${billing}`;
                const priceId = PRICE_IDS[priceKey];

                if (!priceId || priceId.startsWith('price_YOUR_')) {
                    alert('This payment option is not yet configured. Please contact support or try the free trial.');
                    return;
                }

                const response = await fetch('/api/create-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        priceId: priceId,
                        userId: user.id,
                        weddingId: weddingId
                    })
                });

                const data = await response.json();

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    throw new Error('No checkout URL returned');
                }
            } catch (error) {
                console.error('Error selecting plan:', error);
                alert('Error processing your selection. Please try again.');
            }
        }
    </script>
</body>
</html>
