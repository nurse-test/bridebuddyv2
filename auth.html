<!DOCTYPE html>
<html>
<head>
    <title>Bride Buddy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:sans-serif;background:linear-gradient(135deg,#fce4ec,#f3e5f5);height:100vh;display:flex;align-items:center;justify-content:center;}
        .box{background:white;padding:40px;border-radius:20px;width:100%;max-width:400px;}
        h1{text-align:center;margin-bottom:20px;background:linear-gradient(135deg,#ec407a,#ab47bc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
        input{width:100%;padding:12px;margin:10px 0;border:2px solid #fce4ec;border-radius:12px;}
        button{width:100%;padding:14px;background:linear-gradient(135deg,#ec407a,#ab47bc);color:white;border:none;border-radius:12px;margin-top:10px;cursor:pointer;}
        .msg{padding:10px;margin:10px 0;border-radius:8px;text-align:center;}
        .error{background:#ffebee;color:#c62828;}
        .hidden{display:none;}
    </style>
</head>
<body>
    <div class="box">
        <h1>Bride Buddy üíç</h1>
        <div id="msg"></div>
        <form id="form" onsubmit="return false;">
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="pass" placeholder="Password (min 6 chars)" required minlength="6">
            <div id="wFields" class="hidden">
                <input type="text" id="names" placeholder="Couple Names (e.g. Sarah & John)">
                <input type="date" id="date">
            </div>
            <button onclick="submit()">Sign In</button>
            <button type="button" onclick="toggle()" style="background:white;color:#ec407a;border:2px solid #ec407a;">Sign Up</button>
        </form>
    </div>
    <script>
const supabase=window.supabase.createClient('https://nluvnjydydotsrpluhey.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sdXZuanlkeWRvdHNycGx1aGV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NjE5MjAsImV4cCI6MjA3NjMzNzkyMH0.p5S8vYtZeYqp24avigifhjEDRaKv8TxJTaTkeLoE5mY');
let isSignUp=false;
function toggle(){isSignUp=!isSignUp;document.getElementById('wFields').classList.toggle('hidden',!isSignUp);}
async function submit(){
    const email=document.getElementById('email').value;
    const pass=document.getElementById('pass').value;
    document.getElementById('msg').innerHTML='';
    try{
        if(isSignUp){
            const names=document.getElementById('names').value||'My Wedding';
            const date=document.getElementById('date').value||null;
            const {data,error}=await supabase.auth.signUp({email,password:pass,options:{data:{couple_names:names,wedding_date:date}}});
            if(error)throw error;
            // Now create wedding
            const session=await supabase.auth.getSession();
            if(session.data.session){
                await fetch('/api/create-wedding',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userToken:session.data.session.access_token,coupleNames:names,weddingDate:date})});
                window.location.href='/';
            }
        }else{
            const {data,error}=await supabase.auth.signInWithPassword({email,password:pass});
            if(error)throw error;
            // Check if wedding exists, create if not
            const session=await supabase.auth.getSession();
            await fetch('/api/create-wedding',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userToken:session.data.session.access_token,coupleNames:'My Wedding',weddingDate:null})});
            window.location.href='/';
        }
    }catch(e){
        document.getElementById('msg').innerHTML=`<div class="msg error">${e.message}</div>`;
    }
}
    </script>
</body>
</html>
